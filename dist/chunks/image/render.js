(window.webpackJsonp_ultimate_addons_for_gutenberg=window.webpackJsonp_ultimate_addons_for_gutenberg||[]).push([[67],{459:function(e,t,i){"use strict";i.r(t);var a=i(3),n=i.n(a),o=i(153),l=i(6),c=i(9),r=i(2),s=i(152),d=Object(r.createElement)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Object(r.createElement)(s.Path,{d:"M18.5 15v3.5H13V6.7l4.5 4.1 1-1.1-6.2-5.8-5.8 5.8 1 1.1 4-4v11.7h-6V15H4v5h16v-5z"})),u=i(4),m=i(1),g=i(10),h=Object(r.createElement)(s.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Object(r.createElement)(s.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.5h14c.3 0 .5.2.5.5v8.4l-3-2.9c-.3-.3-.8-.3-1 0L11.9 14 9 12c-.3-.2-.6-.2-.8 0l-3.6 2.6V5c-.1-.3.1-.5.4-.5zm14 15H5c-.3 0-.5-.2-.5-.5v-2.4l4.1-3 3 1.9c.3.2.7.2.9-.1L16 12l3.5 3.4V19c0 .3-.2.5-.5.5z"})),v=i(13),b=i(154),p=Object(r.createElement)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Object(r.createElement)(s.Path,{d:"M17.5 7v8H19V7c0-1.1-.9-2-2-2H9v1.5h8c.3 0 .5.2.5.5zM7 17.5c-.3 0-.5-.2-.5-.5V1H5v4H1v1.5h4V17c0 1.1.9 2 2 2h10.5v4H19v-4h4v-1.5H7z"})),f=i(155);const w=["image"];function R({temporaryURL:e,attributes:{url:t="",alt:i,align:a,id:n,width:o,height:s},setAttributes:d,isSelected:g,onCloseModal:h,onSelectImage:R,onSelectURL:E,onUploadError:O,containerRef:j,context:k,clientId:S}){var _;const B=Object(r.useRef)(),{allowResize:y=!0}=(Object(r.useRef)(),Object(v.usePrevious)(t),k),{toggleSelection:L}=Object(c.useDispatch)(u.store),{multiImageSelection:z}=Object(c.useSelect)(e=>{const{getMedia:t}=e(f.store),{getMultiSelectedBlockClientIds:i,getBlockName:a}=e(u.store),o=i();return{image:n&&g?t(n):null,multiImageSelection:o.length&&o.every(e=>"core/image"===a(e))}},[n,g]),{imageEditing:C,maxWidth:H}=Object(c.useSelect)(e=>{const{getBlockRootClientId:t,getSettings:i,canInsertBlockType:a}=e(u.store),n=t(S),{imageEditing:o,imageSizes:l,maxWidth:c,mediaUpload:r}=i();return{imageEditing:o,imageSizes:l,maxWidth:c,mediaUpload:r,canInsertCover:a("core/cover",n)}},[S]),I=Object(v.useViewportMatch)("medium"),U=["wide","full"].includes(a),[{loadedNaturalWidth:x,loadedNaturalHeight:P},W]=Object(r.useState)({}),[M,V]=Object(r.useState)(!1),T=function(e,t){const[i,a]=Object(r.useState)();function n(){a(e.current.clientWidth)}return Object(r.useEffect)(n,t),Object(r.useEffect)(()=>{const{defaultView:t}=e.current.ownerDocument;return t.addEventListener("resize",n),()=>{t.removeEventListener("resize",n)}},[]),i}(j,[a]),F=y&&!(U&&I),{naturalWidth:N,naturalHeight:A}=Object(r.useMemo)(()=>{var e,t;return{naturalWidth:(null===(e=B.current)||void 0===e?void 0:e.naturalWidth)||x||void 0,naturalHeight:(null===(t=B.current)||void 0===t?void 0:t.naturalHeight)||P||void 0}},[x,P,null===(_=B.current)||void 0===_?void 0:_.complete]),D=Object(b.getFilename)(t);let G;G=i||(D?Object(m.sprintf)(
/* translators: %s: file name */
Object(m.__)("This image has an empty alt attribute; its file name is %s"),D):Object(m.__)("This image has an empty alt attribute"));let J,q,K=React.createElement(React.Fragment,null,React.createElement("img",{src:e||t,alt:G,onError:()=>onImageError(),onLoad:e=>{var t,i;W({loadedNaturalWidth:null===(t=e.target)||void 0===t?void 0:t.naturalWidth,loadedNaturalHeight:null===(i=e.target)||void 0===i?void 0:i.naturalHeight})},ref:B}),e&&React.createElement(l.Spinner,null));if(T&&N&&A){const e=N>T,t=A/N;J=e?T:N,q=e?T*t:A}const Q=n&&N&&A&&C,X=!z&&Q&&!M;if(Q&&M)K=React.createElement(u.__experimentalImageEditor,{url:t,width:o,height:s,clientWidth:T,naturalHeight:A,naturalWidth:N});else if(F&&J){const e=o||J,t=s||q,i=N/A,n=N<A?20:20*i,c=A<N?20:20/i,r=2.5*H;let u=!1,h=!1;"center"===a?(u=!0,h=!0):Object(m.isRTL)()?"left"===a?u=!0:h=!0:"right"===a?h=!0:u=!0,K=React.createElement(l.ResizableBox,{size:{width:o||"auto",height:s||"auto"},showHandle:g,minWidth:n,maxWidth:r,minHeight:c,maxHeight:r/i,lockAspectRatio:!0,enable:{top:!1,right:u,bottom:!0,left:h},onResizeStart:function(){L(!1)},onResizeStop:(i,a,n,o)=>{L(!0),d({width:parseInt(e+o.width,10),height:parseInt(t+o.height,10)})}},K)}else K=React.createElement("div",{style:{width:o,height:s}},K);const Y=React.createElement(React.Fragment,null,React.createElement(u.BlockControls,{group:"block"},X&&React.createElement(l.ToolbarButton,{onClick:()=>V(!0),icon:p,label:Object(m.__)("Crop")})),!z&&!M&&React.createElement(u.BlockControls,{group:"other"},React.createElement(u.MediaReplaceFlow,{mediaId:n,mediaURL:t,allowedTypes:w,accept:"image/*",onSelect:R,onSelectURL:E,onError:O,onCloseModal:h})));return React.createElement(React.Fragment,null,React.createElement(u.__experimentalImageEditingProvider,{id:n,url:t,naturalWidth:N,naturalHeight:A,clientWidth:T,onSaveImage:e=>d(e),isEditing:M,onFinishEditing:()=>V(!1)},!e&&Y,K))}const E=(e,t)=>t&&!e&&!Object(o.isBlobURL)(t);function O(){return(O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}const j=e=>{e=e.parentProps;const{attributes:t,setAttributes:i,className:a,isSelected:s,insertBlocksAfter:v,onReplace:b,context:p,clientId:f}=e,{block_id:j,url:k,alt:S,caption:_,align:B,id:y}=t,L=Object(g.a)(),{createNotice:z}=Object(c.useDispatch)("core/notices"),[C,H]=Object(r.useState)(),[I,U]=Object(r.useState)(),x=Object(r.useRef)();Object(r.useEffect)(()=>{x.current=S},[S]);const P=Object(r.useRef)();Object(r.useEffect)(()=>{P.current=_},[_]);const W=Object(r.useRef)(),{imageDefaultSize:M,mediaUpload:V}=Object(c.useSelect)(e=>{const{getSettings:t}=e(u.store),{imageDefaultSize:i,mediaUpload:a}=t();return{imageDefaultSize:i,mediaUpload:a}},[]);function T(){(e=>{var t,i;return((null===(t=wp)||void 0===t||null===(i=t.media)||void 0===i?void 0:i.attachment(e))||{}).destroyed})(null==t?void 0:t.id)&&i({url:void 0,id:void 0})}function F(e){z("error",e,{type:"snackbar"})}function N(e){var a,n,l,c,r;if(!e||!e.url)return void i({url:void 0,alt:void 0,id:void 0,title:void 0,caption:void 0});if(Object(o.isBlobURL)(e.url))return void H(e.url);H();let s,d=((e,t)=>{const{alt:i,id:a,link:n,caption:o}=e,l={alt:i,id:a,link:n,caption:o};return l.url=e.url,l})(e);var u,m;P.current&&!get(d,["caption"])&&(d=omit(d,["caption"])),s=e.id&&e.id===y?{url:k}:{width:void 0,height:void 0,sizeSlug:(u=e,m=M,u.hasOwnProperty("sizes")||u.hasOwnProperty("url")||u.hasOwnProperty("media_details")||u.hasOwnProperty("source_url")||void 0!==u[m]?M:"full")};let g,h=t.linkDestination;if(!h)switch((null===(a=wp)||void 0===a||null===(n=a.media)||void 0===n||null===(l=n.view)||void 0===l||null===(c=l.settings)||void 0===c||null===(r=c.defaultProps)||void 0===r?void 0:r.link)||"none"){case"file":case"media":h="media";break;case"post":case"attachment":h="attachment";break;case"custom":h="custom";break;case"none":h="none"}switch(h){case"media":g=e.url;break;case"attachment":g=e.link}d.href=g,i({...d,...s,linkDestination:h})}function A(e){e!==k&&i({url:e,id:void 0,width:void 0,height:void 0,sizeSlug:M})}function D(e){const t=["wide","full"].includes(e)?{width:void 0,height:void 0}:{};i({...t,align:e})}let G=((e,t)=>!e&&Object(o.isBlobURL)(t))(y,k);Object(r.useEffect)(()=>{if(!G)return;const e=getBlobByURL(k);e&&V({filesList:[e],onFileChange:([e])=>{N(e)},allowedTypes:w,onError:e=>{G=!1,z("error",e,{type:"snackbar"}),i({src:void 0,id:void 0,url:void 0})}})},[]),Object(r.useEffect)(()=>{G?H(k):Object(o.revokeBlobURL)(C)},[G,k]);const J=E(y,k)?k:void 0,q=!!k&&React.createElement("img",{alt:Object(m.__)("Edit image"),title:Object(m.__)("Edit image"),className:"edit-image-preview",src:k});function D(e){const t=["wide","full"].includes(e)?{width:void 0,height:void 0}:{};i({...t,align:e})}Object(r.useEffect)(()=>{E(y,k)&&s&&!I&&window.fetch(k).then(e=>e.blob()).then(e=>U(e)).catch(()=>{})},[y,k,s,I]);const K=Object(u.useBlockProps)({ref:W});return React.createElement(React.Fragment,null,React.createElement(u.BlockControls,{group:"block"},React.createElement(u.BlockAlignmentControl,{value:B,onChange:D}),I&&React.createElement(l.ToolbarButton,{onClick:function(){V({filesList:[I],onFileChange([e]){N(e),Object(o.isBlobURL)(null==e?void 0:e.url)||(U(),z("success",Object(m.__)("Image uploaded."),{type:"snackbar"}))},allowedTypes:w,onError(e){z("error",e,{type:"snackbar"})}})},icon:d,label:Object(m.__)("Upload external image")})),React.createElement("figure",O({},K,{className:n()(a,"uagb-editor-preview-mode-"+L.toLowerCase(),"uagb-block-"+j,"wp-block-uagb-image-align-"+B)}),(C||k)&&React.createElement(R,{temporaryURL:C,attributes:t,setAttributes:i,isSelected:s,insertBlocksAfter:v,onReplace:b,onSelectImage:N,onSelectURL:A,onUploadError:F,containerRef:W,context:p,clientId:f,onCloseModal:T,onImageLoadError:function(e=!1){e||i({url:void 0,id:void 0})}}),!k&&React.createElement(u.BlockControls,{group:"block"},React.createElement(u.BlockAlignmentControl,{value:B,onChange:D})),React.createElement(u.MediaPlaceholder,{icon:React.createElement(u.BlockIcon,{icon:h}),onSelect:N,onSelectURL:A,onError:F,onClose:T,accept:"image/*",allowedTypes:w,value:{id:y,src:J},mediaPreview:q,disableMediaButtons:C||k})))};j.propTypes={},j.defaultProps={},t.default=j}}]);