(window.webpackJsonp_ultimate_addons_for_gutenberg=window.webpackJsonp_ultimate_addons_for_gutenberg||[]).push([[67],{457:function(e,t,i){"use strict";i.r(t);var n=i(3),l=i.n(n),o=i(152),c=i(6),a=i(9),r=i(2),s=i(153),d=Object(r.createElement)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Object(r.createElement)(s.Path,{d:"M18.5 15v3.5H13V6.7l4.5 4.1 1-1.1-6.2-5.8-5.8 5.8 1 1.1 4-4v11.7h-6V15H4v5h16v-5z"})),u=i(4),m=i(1),v=Object(r.createElement)(s.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Object(r.createElement)(s.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.5h14c.3 0 .5.2.5.5v8.4l-3-2.9c-.3-.3-.8-.3-1 0L11.9 14 9 12c-.3-.2-.6-.2-.8 0l-3.6 2.6V5c-.1-.3.1-.5.4-.5zm14 15H5c-.3 0-.5-.2-.5-.5v-2.4l4.1-3 3 1.9c.3.2.7.2.9-.1L16 12l3.5 3.4V19c0 .3-.2.5-.5.5z"}));function b({temporaryURL:e,attributes:{url:t="",alt:i,caption:n,align:l,id:o,href:c,rel:a,linkClass:r,linkDestination:s,title:d,width:u,height:m,linkTarget:v,sizeSlug:b}}){return React.createElement(React.Fragment,null,React.createElement("img",{id:o,src:t}))}const g=(e,t)=>t&&!e&&!Object(o.isBlobURL)(t),p=["image"],f=e=>{e=e.parentProps;const{attributes:t,setAttributes:i,className:n,isSelected:s,insertBlocksAfter:f,onReplace:h,context:w,clientId:k}=e,{url:R,alt:O,caption:E,align:j,id:B,href:S,rel:_,linkClass:y,linkDestination:L,title:U,width:z,height:C,linkTarget:P,sizeSlug:D}=t,{createNotice:x}=Object(a.useDispatch)("core/notices"),[T,V]=Object(r.useState)(),[A,I]=Object(r.useState)(),M=Object(r.useRef)();Object(r.useEffect)(()=>{M.current=O},[O]);const F=Object(r.useRef)();Object(r.useEffect)(()=>{F.current=E},[E]);const H=Object(r.useRef)(),{imageDefaultSize:N,mediaUpload:G}=Object(a.useSelect)(e=>{const{getSettings:t}=e(u.store),{imageDefaultSize:i,mediaUpload:n}=t();return{imageDefaultSize:i,mediaUpload:n}},[]);function J(){(e=>{var t,i;return((null===(t=wp)||void 0===t||null===(i=t.media)||void 0===i?void 0:i.attachment(e))||{}).destroyed})(null==t?void 0:t.id)&&i({url:void 0,id:void 0})}function q(e){x("error",e,{type:"snackbar"})}function K(e){var n,l,c,a,r;if(!e||!e.url)return void i({url:void 0,alt:void 0,id:void 0,title:void 0,caption:void 0});if(Object(o.isBlobURL)(e.url))return void V(e.url);V();let s,d=((e,t)=>{const{alt:i,id:n,link:l,caption:o}=e,c={alt:i,id:n,link:l,caption:o};return c.url=e.url,c})(e);var u,m;F.current&&!get(d,["caption"])&&(d=omit(d,["caption"])),s=e.id&&e.id===B?{url:R}:{width:void 0,height:void 0,sizeSlug:(u=e,m=N,u.hasOwnProperty("sizes")||u.hasOwnProperty("url")||u.hasOwnProperty("media_details")||u.hasOwnProperty("source_url")||void 0!==u[m]?N:"full")};let v,b=t.linkDestination;if(!b)switch((null===(n=wp)||void 0===n||null===(l=n.media)||void 0===l||null===(c=l.view)||void 0===c||null===(a=c.settings)||void 0===a||null===(r=a.defaultProps)||void 0===r?void 0:r.link)||"none"){case"file":case"media":b="media";break;case"post":case"attachment":b="attachment";break;case"custom":b="custom";break;case"none":b="none"}switch(b){case"media":v=e.url;break;case"attachment":v=e.link}d.href=v,i({...d,...s,linkDestination:b})}function Q(e){e!==R&&i({url:e,id:void 0,width:void 0,height:void 0,sizeSlug:N})}function W(e){const t=["wide","full"].includes(e)?{width:void 0,height:void 0}:{};i({...t,align:e})}let X=((e,t)=>!e&&Object(o.isBlobURL)(t))(B,R);Object(r.useEffect)(()=>{if(!X)return;const e=getBlobByURL(R);e&&G({filesList:[e],onFileChange:([e])=>{K(e)},allowedTypes:p,onError:e=>{X=!1,x("error",e,{type:"snackbar"}),i({src:void 0,id:void 0,url:void 0})}})},[]),Object(r.useEffect)(()=>{X?V(R):Object(o.revokeBlobURL)(T)},[X,R]);const Y=g(B,R)?R:void 0,Z=!!R&&React.createElement("img",{alt:Object(m.__)("Edit image"),title:Object(m.__)("Edit image"),className:"edit-image-preview",src:R});function W(e){const t=["wide","full"].includes(e)?{width:void 0,height:void 0}:{};i({...t,align:e})}Object(r.useEffect)(()=>{g(B,R)&&s&&!A&&window.fetch(R).then(e=>e.blob()).then(e=>I(e)).catch(()=>{})},[B,R,s,A]);const $=l()(n,{"is-transient":T,"is-resized":!!z||!!C,["size-"+D]:D}),ee=Object(u.useBlockProps)({ref:H,className:$});return React.createElement(React.Fragment,null,React.createElement(u.BlockControls,{group:"block"},React.createElement(u.BlockAlignmentControl,{value:j,onChange:W}),A&&React.createElement(c.ToolbarButton,{onClick:function(){G({filesList:[A],onFileChange([e]){K(e),Object(o.isBlobURL)(null==e?void 0:e.url)||(I(),x("success",Object(m.__)("Image uploaded."),{type:"snackbar"}))},allowedTypes:p,onError(e){x("error",e,{type:"snackbar"})}})},icon:d,label:Object(m.__)("Upload external image")})),React.createElement("figure",ee,(T||R)&&React.createElement(b,{temporaryURL:T,attributes:t,setAttributes:i,isSelected:s,insertBlocksAfter:f,onReplace:h,onSelectImage:K,onSelectURL:Q,onUploadError:q,containerRef:H,context:w,clientId:k,onCloseModal:J,onImageLoadError:function(e=!1){e||i({url:void 0,id:void 0})}}),!R&&React.createElement(u.BlockControls,{group:"block"},React.createElement(u.BlockAlignmentControl,{value:j,onChange:W})),React.createElement(u.MediaPlaceholder,{icon:React.createElement(u.BlockIcon,{icon:v}),onSelect:K,onSelectURL:Q,onError:q,onClose:J,accept:"image/*",allowedTypes:p,value:{id:B,src:Y},mediaPreview:Z,disableMediaButtons:T||R})))};f.propTypes={},f.defaultProps={},t.default=f}}]);